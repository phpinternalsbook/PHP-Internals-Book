<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Simple classes &#8212; PHP Internals Book</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/haiku.css?v=fce32b03" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=38da9290" />
    <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Custom object storage" href="custom_object_storage.html" />
    <link rel="prev" title="Classes and objects" href="../classes_objects.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>PHP Internals Book</span></a></h1>
        <h2 class="heading"><span>Simple classes</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        «&#160;&#160;<a href="../classes_objects.html">Classes and objects</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="custom_object_storage.html">Custom object storage</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="simple-classes">
<h1>Simple classes<a class="headerlink" href="#simple-classes" title="Link to this heading">¶</a></h1>
<section id="basic-concepts">
<h2>Basic concepts<a class="headerlink" href="#basic-concepts" title="Link to this heading">¶</a></h2>
<p>Zvals store objects using the <code class="docutils literal notranslate"><span class="pre">IS_OBJECT</span></code> type tag and the <code class="docutils literal notranslate"><span class="pre">zend_object_value</span></code> structure in the union, which is
defined as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_zend_object_value</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">zend_object_handle</span><span class="w"> </span><span class="n">handle</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">zend_object_handlers</span><span class="w"> </span><span class="o">*</span><span class="n">handlers</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">zend_object_value</span><span class="p">;</span>
</pre></div>
</div>
<p>The first part of the structure, the <code class="docutils literal notranslate"><span class="pre">zend_object_handle</span></code>, is just a typedef for an unsigned integer. It is an ID
uniquely identifying the object and is used to fetch the actual object data from the object store.</p>
<p>The second part is a pointer to a structure of object handlers. These handlers define the actual behavior of the object.
They cover everything from property fetches and method calls to custom comparison handling or even special garbage
collection semantics.</p>
<p>When called, the individual handlers get passed the object zval as the first argument, followed by various
handler-specific information. They can then use the object handle to fetch the object data from the object store and do
operations on it.</p>
<p>The complementary structure to the object value is the class entry (<code class="docutils literal notranslate"><span class="pre">zend_class_entry</span></code>). Class entries contain a large
amount of information, including the class methods and static properties as well as various handlers, in particular a
handler for creating objects from the class.</p>
</section>
<section id="class-registration">
<h2>Class registration<a class="headerlink" href="#class-registration" title="Link to this heading">¶</a></h2>
<p>Just like functions classes are registered in the extension’s <code class="docutils literal notranslate"><span class="pre">MINIT</span></code> handler. Here is a snippet for declaring an
empty <code class="docutils literal notranslate"><span class="pre">Test</span></code> class:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">zend_class_entry</span><span class="w"> </span><span class="o">*</span><span class="n">test_ce</span><span class="p">;</span>

<span class="k">const</span><span class="w"> </span><span class="n">zend_function_entry</span><span class="w"> </span><span class="n">test_functions</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">PHP_FE_END</span>
<span class="p">};</span>

<span class="n">PHP_MINIT_FUNCTION</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">zend_class_entry</span><span class="w"> </span><span class="n">tmp_ce</span><span class="p">;</span>
<span class="w">    </span><span class="n">INIT_CLASS_ENTRY</span><span class="p">(</span><span class="n">tmp_ce</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">test_functions</span><span class="p">);</span>

<span class="w">    </span><span class="n">test_ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zend_register_internal_class</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmp_ce</span><span class="w"> </span><span class="n">TSRMLS_CC</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first line declares a global variable <code class="docutils literal notranslate"><span class="pre">test_ce</span></code>, which will hold the class entry of the <code class="docutils literal notranslate"><span class="pre">Test</span></code> class. It is a
“true” global variable (without thread safety protection) and should additionally be exported via the header file, so
that other extensions can make use of the class. The following three lines declare an array for the class methods, just
like you would do for normal functions.</p>
<p>Then the main code follows: First a temporary class entry value <code class="docutils literal notranslate"><span class="pre">tmp_ce</span></code> is defined and then initialized using
<code class="docutils literal notranslate"><span class="pre">INIT_CLASS_ENTRY</span></code>. After that the class is registered in the Zend Engine using <code class="docutils literal notranslate"><span class="pre">zend_register_internal_class</span></code>. This
function also returns the final class entry, so it can be stored in the global variable declared above.</p>
<p>To test that the class was registered properly you can run <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">--rc</span> <span class="pre">Test</span></code>, which should give an output along the
following lines:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Class [ &lt;internal:test&gt; class Test ] {
  - Constants [0] {
  }
  - Static properties [0] {
  }
  - Static methods [0] {
  }
  - Properties [0] {
  }
  - Methods [0] {
  }
}
</pre></div>
</div>
<p>As expected what you get is a totally empty class.</p>
</section>
<section id="method-definition-and-declaration">
<h2>Method definition and declaration<a class="headerlink" href="#method-definition-and-declaration" title="Link to this heading">¶</a></h2>
<p>To bring it to life let’s add a method:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PHP_METHOD</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span><span class="w"> </span><span class="n">helloWorld</span><span class="p">)</span><span class="w"> </span><span class="cm">/* {{{ */</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">zend_parse_parameters_none</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FAILURE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">RETURN_STRING</span><span class="p">(</span><span class="s">&quot;Hello World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="cm">/* }}} */</span>

<span class="n">ZEND_BEGIN_ARG_INFO_EX</span><span class="p">(</span><span class="n">arginfo_void</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="n">ZEND_END_ARG_INFO</span><span class="p">()</span>

<span class="k">const</span><span class="w"> </span><span class="n">zend_function_entry</span><span class="w"> </span><span class="n">test_functions</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">PHP_ME</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span><span class="w"> </span><span class="n">helloWorld</span><span class="p">,</span><span class="w"> </span><span class="n">arginfo_void</span><span class="p">,</span><span class="w"> </span><span class="n">ZEND_ACC_PUBLIC</span><span class="p">)</span>
<span class="w">    </span><span class="n">PHP_FE_END</span>
<span class="p">};</span>
</pre></div>
</div>
<p>As you can see a method declaration looks very similar to a function declaration. Instead of <code class="docutils literal notranslate"><span class="pre">PHP_FUNCTION</span></code> we use
<code class="docutils literal notranslate"><span class="pre">PHP_METHOD</span></code> and pass it both the class and method name. In the <code class="docutils literal notranslate"><span class="pre">zend_function_entry</span></code> array <code class="docutils literal notranslate"><span class="pre">PHP_ME</span></code> is used
instead of <code class="docutils literal notranslate"><span class="pre">PHP_FE</span></code>. It again takes the class name, the method name, the arginfo struct and additionally a set of
flags.</p>
<p>The flags parameter allows you to specify the usual PHP method modifiers using a combination of <code class="docutils literal notranslate"><span class="pre">ZEND_ACC_PUBLIC</span></code>,
<code class="docutils literal notranslate"><span class="pre">ZEND_ACC_PROTECTED</span></code>, <code class="docutils literal notranslate"><span class="pre">ZEND_ACC_PRIVATE</span></code>, <code class="docutils literal notranslate"><span class="pre">ZEND_ACC_STATIC</span></code>, <code class="docutils literal notranslate"><span class="pre">ZEND_ACC_FINAL</span></code> and <code class="docutils literal notranslate"><span class="pre">ZEND_ACC_ABSTRACT</span></code>. For
example a protected final static method would be declared as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PHP_ME</span><span class="p">(</span>
<span class="w">    </span><span class="n">Test</span><span class="p">,</span><span class="w"> </span><span class="n">protectedFinalStaticMethod</span><span class="p">,</span><span class="w"> </span><span class="n">arginfo_xyz</span><span class="p">,</span>
<span class="w">    </span><span class="n">ZEND_ACC_PROTECTED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ZEND_ACC_FINAL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ZEND_ACC_STATIC</span>
<span class="p">)</span>
</pre></div>
</div>
<p>As abstract methods do not have an associated implementation the <code class="docutils literal notranslate"><span class="pre">ZEND_ACC_ABSTRACT</span></code> flag is not used directly.
Instead a special macro is provided:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PHP_ABSTRACT_ME</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span><span class="w"> </span><span class="n">abstractMethod</span><span class="p">,</span><span class="w"> </span><span class="n">arginfo_abc</span><span class="p">)</span>
</pre></div>
</div>
<p>Analogous to what happens for <code class="docutils literal notranslate"><span class="pre">PHP_FUNCTION</span></code> the <code class="docutils literal notranslate"><span class="pre">PHP_METHOD</span></code> macro expands into a function declaration with a
special name, which you may encounter when looking at backtraces within method calls:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PHP_METHOD</span><span class="p">(</span><span class="n">ClassName</span><span class="p">,</span><span class="w"> </span><span class="n">methodName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="cm">/* expands to */</span>
<span class="kt">void</span><span class="w"> </span><span class="n">zim_ClassName_methodName</span><span class="p">(</span><span class="n">INTERNAL_FUNCTION_PARAMETERS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>But now, let’s get back to writing methods. Here is another one:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PHP_METHOD</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span><span class="w"> </span><span class="n">getOwnObjectHandle</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">zval</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">zend_parse_parameters_none</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FAILURE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getThis</span><span class="p">();</span>

<span class="w">    </span><span class="n">RETURN_LONG</span><span class="p">(</span><span class="n">Z_OBJ_HANDLE_P</span><span class="p">(</span><span class="n">obj</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">//...</span>
<span class="w">    </span><span class="n">PHP_ME</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span><span class="w"> </span><span class="n">getOwnObjectHandle</span><span class="p">,</span><span class="w"> </span><span class="n">arginfo_void</span><span class="p">,</span><span class="w"> </span><span class="n">ZEND_ACC_PUBLIC</span><span class="p">)</span>
<span class="c1">//...</span>
</pre></div>
</div>
<p>This method does nothing more than return the object’s own object handle. To do this it first grabs the <code class="docutils literal notranslate"><span class="pre">$this</span></code> zval
using the <code class="docutils literal notranslate"><span class="pre">getThis()</span></code> macro and then returns the object handle provided by <code class="docutils literal notranslate"><span class="pre">Z_OBJ_HANDLE_P</span></code>. Try it out:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Test</span><span class="p">;</span>
<span class="nv">$other</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">;</span>
<span class="nv">$t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Test</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$t1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$t2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>This will (probably) output the numbers 1 and 3, so you can see that the object handle is basically just a number
which is incremented with every new object. (This isn’t exactly true because object handles can be reused again once the
associated objects are destroyed.)</p>
</section>
<section id="properties-and-constants">
<h2>Properties and constants<a class="headerlink" href="#properties-and-constants" title="Link to this heading">¶</a></h2>
<p>To do something more useful, let’s create two methods for reading from and writing to a property:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PHP_METHOD</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span><span class="w"> </span><span class="n">getFoo</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">zval</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">foo_value</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">zend_parse_parameters_none</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FAILURE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getThis</span><span class="p">();</span>

<span class="w">    </span><span class="n">foo_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zend_read_property</span><span class="p">(</span><span class="n">test_ce</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">TSRMLS_CC</span><span class="p">);</span>

<span class="w">    </span><span class="n">RETURN_ZVAL</span><span class="p">(</span><span class="n">foo_value</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">PHP_METHOD</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span><span class="w"> </span><span class="n">setFoo</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">zval</span><span class="w"> </span><span class="o">*</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">new_foo_value</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">zend_parse_parameters</span><span class="p">(</span><span class="n">ZEND_NUM_ARGS</span><span class="p">()</span><span class="w"> </span><span class="n">TSRMLS_CC</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;z&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">new_foo_value</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FAILURE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getThis</span><span class="p">();</span>

<span class="w">    </span><span class="n">zend_update_property</span><span class="p">(</span><span class="n">test_ce</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">new_foo_value</span><span class="w"> </span><span class="n">TSRMLS_CC</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ...</span>

<span class="n">ZEND_BEGIN_ARG_INFO_EX</span><span class="p">(</span><span class="n">arginfo_void</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="n">ZEND_END_ARG_INFO</span><span class="p">()</span>

<span class="n">ZEND_BEGIN_ARG_INFO_EX</span><span class="p">(</span><span class="n">arginfo_set</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">ZEND_ARG_INFO</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
<span class="n">ZEND_END_ARG_INFO</span><span class="p">()</span>

<span class="c1">// ...</span>
<span class="w">    </span><span class="n">PHP_ME</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span><span class="w"> </span><span class="n">getFoo</span><span class="p">,</span><span class="w"> </span><span class="n">arginfo_void</span><span class="p">,</span><span class="w"> </span><span class="n">ZEND_ACC_PUBLIC</span><span class="p">)</span>
<span class="w">    </span><span class="n">PHP_ME</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span><span class="w"> </span><span class="n">setFoo</span><span class="p">,</span><span class="w"> </span><span class="n">arginfo_set</span><span class="p">,</span><span class="w"> </span><span class="n">ZEND_ACC_PUBLIC</span><span class="p">)</span>
<span class="c1">// ...</span>
</pre></div>
</div>
<p>The two new functions in the above code are <code class="docutils literal notranslate"><span class="pre">zend_read_property()</span></code> and <code class="docutils literal notranslate"><span class="pre">zend_update_property()</span></code>. Both functions take
the scope as first parameter, the object as second and the property name and length after that. The “scope” here is
a class entry and is necessary for visibility handling. If <code class="docutils literal notranslate"><span class="pre">foo</span></code> is a public property the used scope doesn’t matter
(it could just as well be <code class="docutils literal notranslate"><span class="pre">NULL</span></code>), but if it were a private property we could only access it with the class entry of
the class it belongs to.</p>
<p><code class="docutils literal notranslate"><span class="pre">zend_update_property()</span></code> additionally takes the new value for the property as last parameter. <code class="docutils literal notranslate"><span class="pre">zend_read_property()</span></code>
on the other hand takes an additional boolean <code class="docutils literal notranslate"><span class="pre">silent</span></code> parameter. It specifies whether PHP should suppress the
“Undefined property xyz” notice. In our case we don’t know whether the property exists beforehand, so we pass <code class="docutils literal notranslate"><span class="pre">1</span></code>
(meaning: no notice).</p>
<p>We can try the new functionality out:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nv">$t</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Test</span><span class="p">;</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$t</span><span class="o">-&gt;</span><span class="na">getFoo</span><span class="p">());</span> <span class="c1">// NULL (and no notice, because we passed silent=1)</span>

<span class="nv">$t</span><span class="o">-&gt;</span><span class="na">setFoo</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">);</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$t</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">);</span>      <span class="c1">// &quot;abc&quot;</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$t</span><span class="o">-&gt;</span><span class="na">getFoo</span><span class="p">());</span> <span class="c1">// &quot;abc&quot;</span>

<span class="nv">$t</span><span class="o">-&gt;</span><span class="na">foo</span> <span class="o">=</span> <span class="s2">&quot;def&quot;</span><span class="p">;</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$t</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">);</span>      <span class="c1">// &quot;def&quot;</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$t</span><span class="o">-&gt;</span><span class="na">getFoo</span><span class="p">());</span> <span class="c1">// &quot;def&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">zend_update_property()</span></code> also comes in several variants that allow setting specific values more easily (i.e. without
manually creating a zval):</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">zend_update_property_null(...</span> <span class="pre">TSRMLS_DC)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zend_update_property_bool(...,</span> <span class="pre">long</span> <span class="pre">value</span> <span class="pre">TSRMLS_DC)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zend_update_property_long(...,</span> <span class="pre">long</span> <span class="pre">value</span> <span class="pre">TSRMLS_DC)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zend_update_property_double(...,</span> <span class="pre">double</span> <span class="pre">value</span> <span class="pre">TSRMLS_DC)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zend_update_property_string(...,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*value</span> <span class="pre">TSRMLS_DC)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zend_update_property_stringl(...,</span> <span class="pre">const</span> <span class="pre">char</span> <span class="pre">*value,</span> <span class="pre">int</span> <span class="pre">value_len</span> <span class="pre">TSRMLS_DC)</span></code></p></li>
</ul>
</div></blockquote>
<p>In the above example we had to use the <code class="docutils literal notranslate"><span class="pre">silent=1</span></code> parameter, because we didn’t have the guarantee that the <code class="docutils literal notranslate"><span class="pre">foo</span></code>
property would exist when we read it. A better way to solve this is to properly declare the property when the class is
registered, just like you would write <code class="docutils literal notranslate"><span class="pre">public</span> <span class="pre">$foo</span> <span class="pre">=</span> <span class="pre">DEFAULT_VALUE;</span></code> in PHP.</p>
<p>This is done using the <code class="docutils literal notranslate"><span class="pre">zend_declare_property()</span></code> function family, which features the same variants as
<code class="docutils literal notranslate"><span class="pre">zend_update_property()</span></code>. For example to declare a public <code class="docutils literal notranslate"><span class="pre">foo</span></code> property with a <code class="docutils literal notranslate"><span class="pre">null</span></code> default value we have to add
the following line after the class registration in <code class="docutils literal notranslate"><span class="pre">MINIT</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">zend_declare_property_null</span><span class="p">(</span><span class="n">test_ce</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ZEND_ACC_PUBLIC</span><span class="w"> </span><span class="n">TSRMLS_CC</span><span class="p">);</span>
</pre></div>
</div>
<p>To create a protected property defaulting to the string <code class="docutils literal notranslate"><span class="pre">&quot;bar&quot;</span></code> you instead write:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">zend_declare_property_string</span><span class="p">(</span>
<span class="w">    </span><span class="n">test_ce</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ZEND_ACC_PROTECTED</span><span class="w"> </span><span class="n">TSRMLS_CC</span>
<span class="p">);</span>
</pre></div>
</div>
<p>If you want to use properties (and you will soon find that this is only rarely necessary for internal classes) it is
always good practice to properly declare properties. This way you have an explicit visibility level, a default value
and you also benefit from memory optimizations for declared properties.</p>
<p>Static properties are also declared using the same family of functions by additionally specifying the
<code class="docutils literal notranslate"><span class="pre">ZEND_ACC_STATIC</span></code> flag. A public static <code class="docutils literal notranslate"><span class="pre">$pi</span></code> property:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">zend_declare_property_double</span><span class="p">(</span>
<span class="w">    </span><span class="n">test_ce</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pi&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="s">&quot;pi&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">3.141</span><span class="p">,</span><span class="w"> </span><span class="n">ZEND_ACC_PUBLIC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ZEND_ACC_STATIC</span><span class="w"> </span><span class="n">TSRMLS_CC</span>
<span class="p">);</span>
<span class="cm">/* All digits of pi I remember :( */</span>
</pre></div>
</div>
<p>To read and update static properties there are the <code class="docutils literal notranslate"><span class="pre">zend_read_static_property()</span></code> function and the
<code class="docutils literal notranslate"><span class="pre">zend_update_static_property()</span></code> function family. They have the same interface as the functions for normal properties,
only difference being that no object is passed (only the scope).</p>
<p>To declare constants the <code class="docutils literal notranslate"><span class="pre">zend_declare_class_constant_*()</span></code> family of functions is used. They have the same variations and
signatures as <code class="docutils literal notranslate"><span class="pre">zend_declare_property_*()</span></code>, only without the flags argument. To declare a constant ‘’Test::PI’’:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">zend_declare_class_constant_double</span><span class="p">(</span><span class="n">test_ce</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PI&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="s">&quot;PI&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">3.141</span><span class="w"> </span><span class="n">TSRMLS_CC</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="inheritance-and-interfaces">
<h2>Inheritance and interfaces<a class="headerlink" href="#inheritance-and-interfaces" title="Link to this heading">¶</a></h2>
<p>Just like their userland equivalents internal classes can also inherit from other classes and/or implement interfaces.</p>
<p>A very simple (and quite common) example of inheritance in the PHP tree is creating some custom subtype of
<code class="docutils literal notranslate"><span class="pre">Exception</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">zend_class_entry</span><span class="w"> </span><span class="o">*</span><span class="n">custom_exception_ce</span><span class="p">;</span>

<span class="n">PHP_MINIT_FUNCTION</span><span class="p">(</span><span class="n">Test</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">zend_class_entry</span><span class="w"> </span><span class="n">tmp_ce</span><span class="p">;</span>
<span class="w">    </span><span class="n">INIT_CLASS_ENTRY</span><span class="p">(</span><span class="n">tmp_ce</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CustomException&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="n">custom_exception_ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zend_register_internal_class_ex</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">tmp_ce</span><span class="p">,</span><span class="w"> </span><span class="n">zend_exception_get_default</span><span class="p">(</span><span class="n">TSRMLS_C</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">TSRMLS_CC</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The new thing here is the use of <code class="docutils literal notranslate"><span class="pre">zend_register_internal_class_ex()</span></code> (with the <code class="docutils literal notranslate"><span class="pre">_ex</span></code>), which does the same thing as
<code class="docutils literal notranslate"><span class="pre">zend_register_internal_class()</span></code>, but additionally allows you to specify the parent class entry. Here the parent CE is
fetched using <code class="docutils literal notranslate"><span class="pre">zend_exception_get_default(TSRMLS_C)</span></code>. Another detail worth pointing out is that we did not define a
function structure and instead just passed <code class="docutils literal notranslate"><span class="pre">NULL</span></code> as the last argument to <code class="docutils literal notranslate"><span class="pre">INIT_CLASS_ENTRY</span></code>. This means that we
don’t want any additional methods, apart from those that are inherited from <code class="docutils literal notranslate"><span class="pre">Exception</span></code>.</p>
<p>If you want to extend a more specific SPL extension class like <code class="docutils literal notranslate"><span class="pre">RuntimeException</span></code> you can also do so:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef HAVE_SPL</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ext/spl/spl_exceptions.h&quot;</span>
<span class="cp">#endif</span>

<span class="n">zend_class_entry</span><span class="w"> </span><span class="o">*</span><span class="n">custom_exception_ce</span><span class="p">;</span>

<span class="n">PHP_MINIT_FUNCTION</span><span class="p">(</span><span class="n">Test</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">zend_class_entry</span><span class="w"> </span><span class="n">tmp_ce</span><span class="p">;</span>
<span class="w">    </span><span class="n">INIT_CLASS_ENTRY</span><span class="p">(</span><span class="n">tmp_ce</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CustomException&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="cp">#ifdef HAVE_SPL</span>
<span class="w">    </span><span class="n">custom_exception_ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zend_register_internal_class_ex</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">tmp_ce</span><span class="p">,</span><span class="w"> </span><span class="n">spl_ce_RuntimeException</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">TSRMLS_CC</span>
<span class="w">    </span><span class="p">);</span>
<span class="cp">#else</span>
<span class="w">    </span><span class="n">custom_exception_ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zend_register_internal_class_ex</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">tmp_ce</span><span class="p">,</span><span class="w"> </span><span class="n">zend_exception_get_default</span><span class="p">(</span><span class="n">TSRMLS_C</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">TSRMLS_CC</span>
<span class="w">    </span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above code conditionally either inherits from <code class="docutils literal notranslate"><span class="pre">RuntimeException</span></code> or - if SPL is not compiled in - from just
<code class="docutils literal notranslate"><span class="pre">Exception</span></code>. The class entry for <code class="docutils literal notranslate"><span class="pre">RuntimeException</span></code> is externed in the header <code class="docutils literal notranslate"><span class="pre">ext/spl/spl_exceptions.h</span></code>, so it
has to be included as well.</p>
<p>The last parameter of <code class="docutils literal notranslate"><span class="pre">zend_register_internal_class_ex()</span></code> which was set to <code class="docutils literal notranslate"><span class="pre">NULL</span></code> in the above cases, is an
alternative way to specify the parent class: If you don’t have the class entry available you can specify the class
name:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">custom_exception_ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zend_register_internal_class_ex</span><span class="p">(</span>
<span class="w">    </span><span class="o">&amp;</span><span class="n">tmp_ce</span><span class="p">,</span><span class="w"> </span><span class="n">spl_ce_RuntimeException</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">TSRMLS_CC</span>
<span class="p">);</span>
<span class="cm">/* can also be written as */</span>
<span class="n">custom_exception_ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zend_register_internal_class_ex</span><span class="p">(</span>
<span class="w">    </span><span class="o">&amp;</span><span class="n">tmp_ce</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RuntimeException&quot;</span><span class="w"> </span><span class="n">TSRMLS_CC</span>
<span class="p">);</span>
</pre></div>
</div>
<p>In practice you should prefer the first variant though. The second form is only useful if you have some misbehaved
extension that forgot to export the class entry.</p>
<p>Just like you can inherit from other classes you can also implement interfaces. For this the variadic
<code class="docutils literal notranslate"><span class="pre">zend_class_implements()</span></code> functions is used:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ext/spl/spl_iterators.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;zend_interfaces.h&quot;</span>

<span class="n">zend_class_entry</span><span class="w"> </span><span class="o">*</span><span class="n">data_class_ce</span><span class="p">;</span>

<span class="n">PHP_METHOD</span><span class="p">(</span><span class="n">DataClass</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="n">zend_function_entry</span><span class="w"> </span><span class="n">data_class_functions</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">PHP_ME</span><span class="p">(</span><span class="n">DataClass</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">arginfo_void</span><span class="p">,</span><span class="w"> </span><span class="n">ZEND_ACC_PUBLIC</span><span class="p">)</span>
<span class="w">    </span><span class="cm">/* ... */</span>
<span class="w">    </span><span class="n">PHP_FE_END</span>
<span class="p">};</span>

<span class="n">PHP_MINIT_FUNCTION</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">zend_class_entry</span><span class="w"> </span><span class="n">tmp_ce</span><span class="p">;</span>
<span class="w">    </span><span class="n">INIT_CLASS_ENTRY</span><span class="p">(</span><span class="n">tmp_ce</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DataClass&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data_class_functions</span><span class="p">);</span>
<span class="w">    </span><span class="n">data_class_ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zend_register_internal_class</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmp_ce</span><span class="w"> </span><span class="n">TSRMLS_CC</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* DataClass implements Countable, ArrayAccess, IteratorAggregate */</span>
<span class="w">    </span><span class="n">zend_class_implements</span><span class="p">(</span>
<span class="w">        </span><span class="n">data_class_ce</span><span class="w"> </span><span class="n">TSRMLS_CC</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">spl_ce_Countable</span><span class="p">,</span><span class="w"> </span><span class="n">zend_ce_arrayaccess</span><span class="p">,</span><span class="w"> </span><span class="n">zend_ce_aggregate</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see <code class="docutils literal notranslate"><span class="pre">zend_class_implements()</span></code> takes the class entry, TSRMLS_CC, the number of interfaces to implement and
then the class entries of the interfaces. E.g. if you wanted to additionally implement <code class="docutils literal notranslate"><span class="pre">Serializable</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">zend_class_implements</span><span class="p">(</span>
<span class="w">    </span><span class="n">data_class_ce</span><span class="w"> </span><span class="n">TSRMLS_CC</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">    </span><span class="n">spl_ce_Countable</span><span class="p">,</span><span class="w"> </span><span class="n">zend_ce_arrayaccess</span><span class="p">,</span><span class="w"> </span><span class="n">zend_ce_aggregate</span><span class="p">,</span><span class="w"> </span><span class="n">zend_ce_serializable</span>
<span class="p">);</span>
</pre></div>
</div>
<p>You can obviously also create your own interfaces. Interfaces are registered in the same way as classes are, but using
the <code class="docutils literal notranslate"><span class="pre">zend_register_internal_interface()</span></code> function and declaring all methods as abstract. E.g. if you wanted to create a
new <code class="docutils literal notranslate"><span class="pre">ReversibleIterator</span></code> interface that extends <code class="docutils literal notranslate"><span class="pre">Iterator</span></code> and additionally specifies a <code class="docutils literal notranslate"><span class="pre">prev</span></code> method, this is how
you would do it:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;zend_interfaces.h&quot;</span>

<span class="n">zend_class_entry</span><span class="w"> </span><span class="o">*</span><span class="n">reversible_iterator_ce</span><span class="p">;</span>

<span class="k">const</span><span class="w"> </span><span class="n">zend_function_entry</span><span class="w"> </span><span class="n">reversible_iterator_functions</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">PHP_ABSTRACT_ME</span><span class="p">(</span><span class="n">ReversibleIterator</span><span class="p">,</span><span class="w"> </span><span class="n">prev</span><span class="p">,</span><span class="w"> </span><span class="n">arginfo_void</span><span class="p">)</span>
<span class="w">    </span><span class="n">PHP_FE_END</span>
<span class="p">};</span>

<span class="n">PHP_MINIT_FUNCTION</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">zend_class_entry</span><span class="w"> </span><span class="n">tmp_ce</span><span class="p">;</span>
<span class="w">    </span><span class="n">INIT_CLASS_ENTRY</span><span class="p">(</span><span class="n">tmp_ce</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ReversibleIterator&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">reversible_iterator_functions</span><span class="p">);</span>
<span class="w">    </span><span class="n">reversible_iterator_ce</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zend_register_internal_interface</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmp_ce</span><span class="w"> </span><span class="n">TSRMLS_CC</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* ReversibleIterator extends Iterator. For interface inheritance the zend_class_implements()</span>
<span class="cm">     * function is used. */</span>
<span class="w">    </span><span class="n">zend_class_implements</span><span class="p">(</span><span class="n">reversible_iterator_ce</span><span class="w"> </span><span class="n">TSRMLS_CC</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zend_ce_iterator</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Internal interfaces have a bit of additional power that userland interfaces don’t have - but I’ll leave that for a bit
later.</p>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        «&#160;&#160;<a href="../classes_objects.html">Classes and objects</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="custom_object_storage.html">Custom object storage</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer feedback">
        The repository for this book is available on <a href="https://github.com/phpinternalsbook/PHP-Internals-Book">GitHub</a>.
        <br/><br/>
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
            <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
        </a>
        <br />
        The PHP internals book is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-41617167-1', 'phpinternalsbook.com');
      ga('send', 'pageview');
    </script>

  </body>
</html>