<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Running the test suite &#8212; PHP Internals Book</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/haiku.css?v=fce32b03" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=38da9290" />
    <script src="../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The .phpt file structure" href="phpt_file_structure.html" />
    <link rel="prev" title="Testing overview" href="overview.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>PHP Internals Book</span></a></h1>
        <h2 class="heading"><span>Running the test suite</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        «&#160;&#160;<a href="overview.html">Testing overview</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="phpt_file_structure.html">The <code class="docutils literal notranslate"><span class="pre">.phpt</span></code> file structure</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="running-the-test-suite">
<span id="id1"></span><h1>Running the test suite<a class="headerlink" href="#running-the-test-suite" title="Link to this heading">¶</a></h1>
<p>Now that we have an basic understanding of what kind of testing we’re doing, let’s run the test suite. Before we can run
the tests, make sure you have successfully built php from source (see <a class="reference internal" href="../php7/build_system/building_php.html#building-php"><span class="std std-ref">Building PHP</span></a>) and you have an executable
at <code class="docutils literal notranslate"><span class="pre">sapi/cli/php</span></code>.</p>
<p>There are two ways to run the test suite.</p>
<section id="running-tests-directly-with-run-tests-php">
<h2>Running tests directly with <code class="docutils literal notranslate"><span class="pre">run-tests.php</span></code><a class="headerlink" href="#running-tests-directly-with-run-tests-php" title="Link to this heading">¶</a></h2>
<p>You can run the test suite directly with run-tests.php. At minimum you’ll need to specify the php executable that you
wish to test against which you can do with the <code class="docutils literal notranslate"><span class="pre">-p</span></code> flag. Note that in order to run all tests correctly this should be
an absolute path to the PHP executable.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/php-src&gt;<span class="w"> </span>sapi/cli/php<span class="w"> </span>run-tests.php<span class="w"> </span>-p<span class="w"> </span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/sapi/cli/php
</pre></div>
</div>
<p>A shortcut flag you can use to tell run-tests to test against the PHP executable that is currently invoked is by using
the <code class="docutils literal notranslate"><span class="pre">-P</span></code> flag.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/php-src&gt;<span class="w"> </span>sapi/cli/php<span class="w"> </span>run-tests.php<span class="w"> </span>-P
</pre></div>
</div>
<p>If you don’t want to have to set the <code class="docutils literal notranslate"><span class="pre">-p</span></code> or <code class="docutils literal notranslate"><span class="pre">-P</span></code> flag every time, you could specify the php executable with the
<code class="docutils literal notranslate"><span class="pre">TEST_PHP_EXECUTABLE</span></code> environment variable which can be set with <code class="docutils literal notranslate"><span class="pre">export</span></code> on Linux machines.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/php-src&gt;<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">TEST_PHP_EXECUTABLE</span><span class="o">=</span>sapi/cli/php
~/php-src&gt;<span class="w"> </span>sapi/cli/php<span class="w"> </span>run-tests.php
</pre></div>
</div>
<p>On Windows you can set the environment variable using <code class="docutils literal notranslate"><span class="pre">set</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>C:<span class="se">\p</span>hp-src&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">TEST_PHP_EXECUTABLE</span><span class="o">=</span>sapi/cli/php
C:<span class="se">\p</span>hp-src&gt;<span class="w"> </span>sapi/cli/php<span class="w"> </span>run-tests.php
</pre></div>
</div>
<p>By default <code class="docutils literal notranslate"><span class="pre">run-tests.php</span></code> will start running all 15,000+ tests in the test suite which would take forever-ever. You
can specify a target folder of tests to run or even a single test. The following example will run all the tests
associated with <a class="reference external" href="http://php.net/csprng">PHP 7’s CSPRNG</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/php-src&gt;<span class="w"> </span>sapi/cli/php<span class="w"> </span>run-tests.php<span class="w"> </span>-P<span class="w"> </span>ext/standard/tests/random
</pre></div>
</div>
<p>You can also specify multiple target folders or files to run.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/php-src&gt;<span class="w"> </span>sapi/cli/php<span class="w"> </span>run-tests.php<span class="w"> </span>-P<span class="w"> </span>Zend/<span class="w"> </span>ext/reflection/<span class="w"> </span>ext/standard/tests/array/
</pre></div>
</div>
<p>If you run the full test suite, and there are failing tests, the script will ask if you want to send a report to the
PHP QA team. This can be annoying sometimes. It is possible suppress this question by setting the <code class="docutils literal notranslate"><span class="pre">-q</span></code> flag, or by
setting environment variable <code class="docutils literal notranslate"><span class="pre">NO_INTERACTION=1</span></code>.</p>
</section>
<section id="running-tests-via-the-makefile-recommended">
<h2>Running tests via the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> (recommended)<a class="headerlink" href="#running-tests-via-the-makefile-recommended" title="Link to this heading">¶</a></h2>
<p>The recommended way of running the test suite is via the <code class="docutils literal notranslate"><span class="pre">test</span></code> target which is defined in the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>. The
<code class="docutils literal notranslate"><span class="pre">test</span></code> target does all the hard work of specifying the PHP executable for you (the one you compiled), setting up some
default INI settings and specifying the best run-tests flags for you. You needn’t worry about setting environment
variables or setting additional flags so the command is very simple.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/php-src&gt;<span class="w"> </span>make<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>As before, <code class="docutils literal notranslate"><span class="pre">run-tests.php</span></code> will start running the entire test suite. To specify a folder or single test to execute you
can pass <code class="docutils literal notranslate"><span class="pre">make</span></code> a <code class="docutils literal notranslate"><span class="pre">TESTS</span></code> variable. The following example will test that PHP can handle binary literals properly.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/php-src&gt;<span class="w"> </span>make<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="nv">TESTS</span><span class="o">=</span>Zend/tests/binary.phpt
</pre></div>
</div>
<p>You can specify multiple target folders or files to run by separating each path with a space in the <code class="docutils literal notranslate"><span class="pre">TESTS</span></code> variable.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/php-src&gt;<span class="w"> </span>make<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="nv">TESTS</span><span class="o">=</span><span class="s2">&quot;Zend/ ext/reflection/ ext/standard/tests/array/&quot;</span>
</pre></div>
</div>
</section>
<section id="executing-tests-in-parallel">
<h2>Executing tests in parallel<a class="headerlink" href="#executing-tests-in-parallel" title="Link to this heading">¶</a></h2>
<p>Since PHP 7.4 you are able to run tests in parallel by passing a <code class="docutils literal notranslate"><span class="pre">-j&lt;workers&gt;</span></code> flag to <code class="docutils literal notranslate"><span class="pre">run-tests.php</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;workers&gt;</span></code> is the number of parallel processes you want. For example, <code class="docutils literal notranslate"><span class="pre">-j4</span></code> would run 4 tests at once.</p>
<p>Example for running tests through run-tests.php:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>run-tests.php<span class="w"> </span>-j8
</pre></div>
</div>
<p>Example for running tests through make:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="nv">TESTS</span><span class="o">=</span><span class="s2">&quot;-j8&quot;</span>
</pre></div>
</div>
</section>
<section id="more-options">
<h2>More options<a class="headerlink" href="#more-options" title="Link to this heading">¶</a></h2>
<p>Tests that passed are usually not that interesting. You can filter what tests to show with the <code class="docutils literal notranslate"><span class="pre">-g</span></code> flag. Possible
values are <code class="docutils literal notranslate"><span class="pre">PASS</span></code>, <code class="docutils literal notranslate"><span class="pre">FAIL</span></code>, <code class="docutils literal notranslate"><span class="pre">XFAIL</span></code>, <code class="docutils literal notranslate"><span class="pre">SKIP</span></code>, <code class="docutils literal notranslate"><span class="pre">BORK</span></code>, <code class="docutils literal notranslate"><span class="pre">WARN</span></code>, <code class="docutils literal notranslate"><span class="pre">LEAK</span></code>, <code class="docutils literal notranslate"><span class="pre">REDIRECT</span></code> For example to only
show failing tests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/php-src&gt;<span class="w"> </span>run-tests.php<span class="w"> </span>-g<span class="w"> </span>FAIL
</pre></div>
</div>
<p>For a full list of supported options that run-tests supports, just run it with <code class="docutils literal notranslate"><span class="pre">--help</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/php-src&gt;<span class="w"> </span>sapi/cli/php<span class="w"> </span>run-tests.php<span class="w"> </span>--help
</pre></div>
</div>
<p>For example <code class="docutils literal notranslate"><span class="pre">-x</span></code> to skip slow tests, <code class="docutils literal notranslate"><span class="pre">--offline</span></code> to skip online tests or <code class="docutils literal notranslate"><span class="pre">-m</span></code> for testing memory leaks with
Valgrind can be very useful.</p>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        «&#160;&#160;<a href="overview.html">Testing overview</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="phpt_file_structure.html">The <code class="docutils literal notranslate"><span class="pre">.phpt</span></code> file structure</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer feedback">
        The repository for this book is available on <a href="https://github.com/phpinternalsbook/PHP-Internals-Book">GitHub</a>.
        <br/><br/>
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
            <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
        </a>
        <br />
        The PHP internals book is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-41617167-1', 'phpinternalsbook.com');
      ga('send', 'pageview');
    </script>

  </body>
</html>