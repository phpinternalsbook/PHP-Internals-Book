<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Memory management &#8212; PHP Internals Book</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/haiku.css?v=fce32b03" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=38da9290" />
    <script src="../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Zend Memory Manager" href="memory_management/zend_memory_manager.html" />
    <link rel="prev" title="Zend Extensions" href="extensions_design/zend_extensions.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>PHP Internals Book</span></a></h1>
        <h2 class="heading"><span>Memory management</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        «&#160;&#160;<a href="extensions_design/zend_extensions.html">Zend Extensions</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="memory_management/zend_memory_manager.html">Zend Memory Manager</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="memory-management">
<h1>Memory management<a class="headerlink" href="#memory-management" title="Link to this heading">¶</a></h1>
<p>C programmers usually have to deal with memory by hand. With dynamic memory, the programmer allocates memory when
needing and frees it when finished. Failing to free dynamic memory leads to a “memory leak”, which may or may not be a
bad thing. In the case of PHP, as the process could live for a virtually infinite amount of time, creating a memory leak
will be dramatic. In any situation, leaking memory really translates to poorly and badly designed programs that cannot
be trusted.
Memory leaking is easy to understand. You ask the OS to book some part of the main machine memory for you, but you never
tell it to release it back for other processes usage : you are not alone on the machine, other processes need some
memory, and the OS itself as well.</p>
<p>Also, in C, memory areas are clearly bound. Reading or writing before or after the bounds is a very nasty operation.
That will lead for sure to a crash, or worse an exploitable security issue. There are no magical things like
auto-resizeable areas with the C language. You must clearly tell the machine (and the CPU) what you want it to do. No
guess, no magic, no automation of any kind (like garbage collection).</p>
<p>PHP’s got a very specific memory model, and provides its own layer over the traditional libc’s dynamic memory
allocator. This layer is called <strong>Zend Memory Manager</strong>.</p>
<p>This chapter explains you what Zend Memory Manager is, how you must use it, and what you must/must not do with it.
After that, we’ll quickly introduce you to specific tools used in the C area to debug dynamic memory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you need, please get some (possibly strong) knowledge about C memory allocation classes (static vs
dynamic memory), and about libc’s allocator.</p>
</div>
<p>Contents:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="memory_management/zend_memory_manager.html">Zend Memory Manager</a><ul>
<li class="toctree-l2"><a class="reference internal" href="memory_management/zend_memory_manager.html#the-two-main-kind-of-dynamic-memory-pools-in-php">The two main kind of dynamic memory pools in PHP</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management/zend_memory_manager.html#zend-memory-manager-api">Zend Memory Manager API</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management/zend_memory_manager.html#zend-memory-manager-debugging-shields">Zend Memory Manager debugging shields</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management/zend_memory_manager.html#lifecycle">Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management/zend_memory_manager.html#zendmm-internal-design">ZendMM internal design</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management/zend_memory_manager.html#hooking-into-the-zendmm">Hooking into the ZendMM</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management/zend_memory_manager.html#common-errors-and-mistakes">Common errors and mistakes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="memory_management/memory_debugging.html">Debugging memory</a><ul>
<li class="toctree-l2"><a class="reference internal" href="memory_management/memory_debugging.html#a-quick-note-about-valgrind">A quick note about valgrind</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management/memory_debugging.html#before-starting">Before starting</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management/memory_debugging.html#memory-leak-detection-example">Memory leak detection example</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management/memory_debugging.html#buffer-overflow-underflow-detection">Buffer overflow/underflow detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory_management/memory_debugging.html#conclusions">Conclusions</a></li>
</ul>
</li>
</ul>
</div>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        «&#160;&#160;<a href="extensions_design/zend_extensions.html">Zend Extensions</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="memory_management/zend_memory_manager.html">Zend Memory Manager</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer feedback">
        The repository for this book is available on <a href="https://github.com/phpinternalsbook/PHP-Internals-Book">GitHub</a>.
        <br/><br/>
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
            <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
        </a>
        <br />
        The PHP internals book is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-41617167-1', 'phpinternalsbook.com');
      ga('send', 'pageview');
    </script>

  </body>
</html>