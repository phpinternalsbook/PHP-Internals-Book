<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Debugging with GDB &#8212; PHP Internals Book</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/haiku.css?v=fce32b03" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=38da9290" />
    <script src="../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Introduction" href="../php5/introduction.html" />
    <link rel="prev" title="Zend opcache" href="zend_engine/zend_opcache.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>PHP Internals Book</span></a></h1>
        <h2 class="heading"><span>Debugging with GDB</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        «&#160;&#160;<a href="zend_engine/zend_opcache.html">Zend opcache</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="../php5/introduction.html">Introduction</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="debugging-with-gdb">
<h1>Debugging with GDB<a class="headerlink" href="#debugging-with-gdb" title="Link to this heading">¶</a></h1>
<p>This chapter will introduce you with the GNU C debugger, aka GDB. When a crash happens, you usually have to find the
guilty part in thousands of lines. You need tools for that, and GDB is the most commonly used debugger under Unix
platforms. Here we’ll give you an introduction to GDB and how to practice with it against the PHP source code.</p>
<section id="debug-symbols">
<h2>Debug symbols<a class="headerlink" href="#debug-symbols" title="Link to this heading">¶</a></h2>
<p>GDB requires debug symbols to map the memory addresses in your binary to the original position in your source code. To
generate debug symbols you need to pass the <code class="docutils literal notranslate"><span class="pre">--enable-debug</span></code> flag to the <code class="docutils literal notranslate"><span class="pre">./configure</span></code> script. To get even more
debugging information you may add the <code class="docutils literal notranslate"><span class="pre">CFLAGS=&quot;-ggdb3&quot;</span></code> flag which will add support for macros.</p>
</section>
<section id="debugging-the-vm">
<h2>Debugging the VM<a class="headerlink" href="#debugging-the-vm" title="Link to this heading">¶</a></h2>
<p>The VM lives in the big <code class="docutils literal notranslate"><span class="pre">zend_vm_execute.h</span></code> file that is generated by <code class="docutils literal notranslate"><span class="pre">zend_vm_gen.php</span></code> from <code class="docutils literal notranslate"><span class="pre">zend_vm_def.h</span></code>.
Debugging this file can be tedious because it is very large, and it’s often not obvious which specialized handler
will run. Luckily, it is possible to debug <code class="docutils literal notranslate"><span class="pre">zend_vm_def.h</span></code> directly by generating the VM using the
<code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">Zend/zend_vm_gen.php</span> <span class="pre">--with-lines</span></code> command. This will annotate the code with the <code class="docutils literal notranslate"><span class="pre">#line</span></code> preprocessor directive
to allow the debugger to know the origin of the generated instructions.</p>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        «&#160;&#160;<a href="zend_engine/zend_opcache.html">Zend opcache</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="../php5/introduction.html">Introduction</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer feedback">
        The repository for this book is available on <a href="https://github.com/phpinternalsbook/PHP-Internals-Book">GitHub</a>.
        <br/><br/>
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
            <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
        </a>
        <br />
        The PHP internals book is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-41617167-1', 'phpinternalsbook.com');
      ga('send', 'pageview');
    </script>

  </body>
</html>