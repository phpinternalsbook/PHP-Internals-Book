<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Object handlers &#8212; PHP Internals Book</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/haiku.css?v=e491ac2d" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=38da9290" />
    <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Extensions design" href="../extensions_design.html" />
    <link rel="prev" title="Classes and objects" href="../classes_objects.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>PHP Internals Book</span></a></h1>
        <h2 class="heading"><span>Object handlers</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="../classes_objects.html">Classes and objects</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="../extensions_design.html">Extensions design</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="object-handlers">
<h1>Object handlers<a class="headerlink" href="#object-handlers" title="Link to this heading">¶</a></h1>
<p>Nearly all operations on objects in PHP go through object handlers and every magic method or magic interface is
implemented with an object or class handler internally. Furthermore there are quite a few handlers which are not exposed
to userland PHP. For example internal classes can have custom comparison and cast behavior.</p>
<section id="an-overview">
<h2>An Overview<a class="headerlink" href="#an-overview" title="Link to this heading">¶</a></h2>
<p>Here are all the object handlers with their signature and a small description.</p>
<dl class="c member">
<dt class="sig sig-object c" id="c.read_property">
<span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">read_property</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">object</span></span>, <span class="n"><span class="pre">zend_string</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">member</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cache_slot</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rv</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.read_property" title="Link to this definition">¶</a><br /></dt>
<dt class="sig sig-object c" id="c.write_property">
<span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">write_property</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">object</span></span>, <span class="n"><span class="pre">zend_string</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">member</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">value</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cache_slot</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.write_property" title="Link to this definition">¶</a><br /></dt>
<dt class="sig sig-object c" id="c.has_property">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">has_property</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">zobj</span></span>, <span class="n"><span class="pre">zend_string</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">name</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">has_set_exists</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cache_slot</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.has_property" title="Link to this definition">¶</a><br /></dt>
<dt class="sig sig-object c" id="c.unset_property">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">unset_property</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">zobj</span></span>, <span class="n"><span class="pre">zend_string</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">name</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cache_slot</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.unset_property" title="Link to this definition">¶</a><br /></dt>
<dt class="sig sig-object c" id="c.get_property_ptr_ptr">
<span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">get_property_ptr_ptr</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">zobj</span></span>, <span class="n"><span class="pre">zend_string</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">name</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cache_slot</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.get_property_ptr_ptr" title="Link to this definition">¶</a><br /></dt>
<dd><p>These handlers correspond to the <code class="docutils literal notranslate"><span class="pre">__get</span></code>, <code class="docutils literal notranslate"><span class="pre">__set</span></code>, <code class="docutils literal notranslate"><span class="pre">__isset</span></code> and <code class="docutils literal notranslate"><span class="pre">__unset</span></code> methods. <code class="docutils literal notranslate"><span class="pre">get_property_ptr_ptr</span></code>
is the internal equivalent of <code class="docutils literal notranslate"><span class="pre">__get</span></code> returning by reference. <code class="docutils literal notranslate"><span class="pre">cache_slot</span></code> is used to store the property
offset and <code class="docutils literal notranslate"><span class="pre">zend_property_info</span></code>. <code class="docutils literal notranslate"><span class="pre">read_property</span></code> may directly return a zval owned by the object, in which case
its reference count should not be modified by <code class="docutils literal notranslate"><span class="pre">read_property</span></code>, and the caller should not release it.
Alternatively, it may return <code class="docutils literal notranslate"><span class="pre">rv</span></code> for temporary zvals (e.g. result of call to <code class="docutils literal notranslate"><span class="pre">__get</span></code>), in which case the
refcount should be incremented, and the caller is responsible for releasing the value.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.read_dimension">
<span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">read_dimension</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">object</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">offset</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rv</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.read_dimension" title="Link to this definition">¶</a><br /></dt>
<dt class="sig sig-object c" id="c.write_dimension">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">write_dimension</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">object</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">offset</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">value</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.write_dimension" title="Link to this definition">¶</a><br /></dt>
<dt class="sig sig-object c" id="c.has_dimension">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">has_dimension</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">object</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">offset</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">check_empty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.has_dimension" title="Link to this definition">¶</a><br /></dt>
<dt class="sig sig-object c" id="c.unset_dimension">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">unset_dimension</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">object</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">offset</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.unset_dimension" title="Link to this definition">¶</a><br /></dt>
<dd><p>This set of handlers is the internal representation of the <code class="docutils literal notranslate"><span class="pre">ArrayAccess</span></code> interface. <code class="docutils literal notranslate"><span class="pre">zval</span> <span class="pre">*rv</span></code> in
<code class="docutils literal notranslate"><span class="pre">read_dimension</span></code> is used for temporary values returned from <code class="docutils literal notranslate"><span class="pre">offsetGet</span></code> and <code class="docutils literal notranslate"><span class="pre">offsetExists</span></code>.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.get_properties">
<span class="n"><span class="pre">HashTable</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">get_properties</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">zobj</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.get_properties" title="Link to this definition">¶</a><br /></dt>
<dt class="sig sig-object c" id="c.get_debug_info">
<span class="n"><span class="pre">HashTable</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">get_debug_info</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">object</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">is_temp</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.get_debug_info" title="Link to this definition">¶</a><br /></dt>
<dd><p>Used to get the object properties as a hashtable. The former is more general purpose, for example it is also used
for the <code class="docutils literal notranslate"><span class="pre">get_object_vars</span></code> function. The latter on the other hand is used exclusively to display properties in
debugging functions like <code class="docutils literal notranslate"><span class="pre">var_dump</span></code>. So even if your object does not provide any formal properties you can still
have a meaningful debug output.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.get_method">
<span class="n"><span class="pre">zend_function</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">get_method</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">obj_ptr</span></span>, <span class="n"><span class="pre">zend_string</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">method_name</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">key</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.get_method" title="Link to this definition">¶</a><br /></dt>
<dd><p>The <code class="docutils literal notranslate"><span class="pre">get_method</span></code> handler fetches the <code class="docutils literal notranslate"><span class="pre">zend_function</span></code> used to call a certain method. Optionally <code class="docutils literal notranslate"><span class="pre">key</span></code> can be
passed as an optimization to avoid lowercasing <code class="docutils literal notranslate"><span class="pre">method_name</span></code> in case it is already present.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.get_constructor">
<span class="n"><span class="pre">zend_function</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">get_constructor</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">zobj</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.get_constructor" title="Link to this definition">¶</a><br /></dt>
<dd><p>Like <code class="docutils literal notranslate"><span class="pre">get_method</span></code>, but getting the constructor function. The most common reason to override this handler is to
disallow manual construction by throwing an error in the handler.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.count_elements">
<span class="n"><span class="pre">zend_result</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">count_elements</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">object</span></span>, <span class="n"><span class="pre">zend_long</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">count</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.count_elements" title="Link to this definition">¶</a><br /></dt>
<dd><p>This is just the internal way of implementing the <code class="docutils literal notranslate"><span class="pre">Countable::count</span></code> method. The function returns a
<code class="docutils literal notranslate"><span class="pre">zend_result</span></code> and assigns the value to the <code class="docutils literal notranslate"><span class="pre">zend_long</span> <span class="pre">*count</span></code> pointer.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.compare">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">compare</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">o1</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">o2</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.compare" title="Link to this definition">¶</a><br /></dt>
<dd><p>The <code class="docutils literal notranslate"><span class="pre">compare</span></code> handler is a required handler that computes equality of the given object and another value. Note
that the other value isn’t necessarily an object of the same class, or even an object at all. The handler should
return negative numbers if the lhs is smaller, 0 if they are equal, or a positive number is the lhs is larger. If
the values are uncomparable <code class="docutils literal notranslate"><span class="pre">ZEND_UNCOMPARABLE</span></code> should be returned.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.cast_object">
<span class="n"><span class="pre">zend_result</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">cast_object</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">readobj</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">writeobj</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.cast_object" title="Link to this definition">¶</a><br /></dt>
<dd><p>Internal classes have the ability to implement a custom compare behavior and override casting behavior for all
types. Userland classes on the other hand only have the ability to override object to string casting through
<code class="docutils literal notranslate"><span class="pre">__toString</span></code>.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.get_closure">
<span class="n"><span class="pre">zend_result</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">get_closure</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">obj</span></span>, <span class="n"><span class="pre">zend_class_entry</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ce_ptr</span></span>, <span class="n"><span class="pre">zend_function</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fptr_ptr</span></span>, <span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">obj_ptr</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">check_only</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.get_closure" title="Link to this definition">¶</a><br /></dt>
<dd><p>This handler is invoked when the object is used as a function, i.e. it is the internal version of <code class="docutils literal notranslate"><span class="pre">__invoke</span></code>.
The name derives from the fact that its main use is for the implementation of closures (the <code class="docutils literal notranslate"><span class="pre">Closure</span></code> class).</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.get_class_name">
<span class="n"><span class="pre">zend_string</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">get_class_name</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">zobj</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.get_class_name" title="Link to this definition">¶</a><br /></dt>
<dd><p>This handler is used to get the class name from an object for debugging contexts. There should be little reason to
overwrite it.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.clone_obj">
<span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">clone_obj</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">old_object</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.clone_obj" title="Link to this definition">¶</a><br /></dt>
<dd><p>The <code class="docutils literal notranslate"><span class="pre">clone_obj</span></code> handler is called when executing <code class="docutils literal notranslate"><span class="pre">clone</span> <span class="pre">$old_object</span></code>. By default PHP performs a shallow clone
on objects, which means properties containing objects are not be cloned but both the old and new object will point
to the same object. The <code class="docutils literal notranslate"><span class="pre">clone_obj</span></code> allows for this behavior to be customized. It’s also used to inhibit <code class="docutils literal notranslate"><span class="pre">clone</span></code>
altogether.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.get_gc">
<span class="n"><span class="pre">HashTable</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">get_gc</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">zobj</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">table</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">n</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.get_gc" title="Link to this definition">¶</a><br /></dt>
<dd><p>The <code class="docutils literal notranslate"><span class="pre">get_gc</span></code> handler should return all variables that are held by the object, so cyclic dependencies can be
properly collected. If the object doesn’t maintain a property hashmap (because it doesn’t store any dynamic
properties) it can use <code class="docutils literal notranslate"><span class="pre">table</span></code> to store a pointer directly into the list of zvals, along with a count of
properties.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.dtor_obj">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dtor_obj</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">object</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.dtor_obj" title="Link to this definition">¶</a><br /></dt>
<dt class="sig sig-object c" id="c.free_obj">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">free_obj</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">object</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.free_obj" title="Link to this definition">¶</a><br /></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">dtor_obj</span></code> is called before <code class="docutils literal notranslate"><span class="pre">free_obj</span></code>. The object must remain in a valid state after dtor_obj finishes running.
Unlike <code class="docutils literal notranslate"><span class="pre">free_obj</span></code>, it is run prior to deactivation of the executor during shutdown, which allows user code to run.
This handler is not guaranteed to be called (e.g. on fatal error), and as such should not be used to release
resources or deallocate memory. Furthermore, releasing resources in this handler can break detection of memory
leaks, as cycles may be broken early. <code class="docutils literal notranslate"><span class="pre">dtor_obj</span></code> should be used only to call user destruction hooks, such as
<code class="docutils literal notranslate"><span class="pre">__destruct</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">free_obj</span></code> should release any resources the object holds, without freeing the object structure itself. The object
does not need to be in a valid state after <code class="docutils literal notranslate"><span class="pre">free_obj</span></code> finishes running. <code class="docutils literal notranslate"><span class="pre">free_obj</span></code> will always be invoked, even
if the object leaks or a fatal error occurs. However, during shutdown it may be called once the executor is no
longer active, in which case execution of user code may be skipped.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.do_operation">
<span class="n"><span class="pre">zend_result</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">do_operation</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_uchar</span></span><span class="w"> </span><span class="n"><span class="pre">opcode</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">result</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">op1</span></span>, <span class="n"><span class="pre">zval</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">op2</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.do_operation" title="Link to this definition">¶</a><br /></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">do_operation</span></code> is an optional handler that will be invoked for various arithmetic and binary operations on
instances of the given class. This allows for operator overloading semantics to be implemented for custom classes.
Examples for overloadable operators are <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">++</span></code>, <code class="docutils literal notranslate"><span class="pre">--</span></code>, <code class="docutils literal notranslate"><span class="pre">!</span></code>.</p>
</dd></dl>

<dl class="c member">
<dt class="sig sig-object c" id="c.get_properties_for">
<span class="n"><span class="pre">zend_array</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">get_properties_for</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">zend_object</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">object</span></span>, <span class="n"><span class="pre">zend_prop_purpose</span></span><span class="w"> </span><span class="n"><span class="pre">purpose</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.get_properties_for" title="Link to this definition">¶</a><br /></dt>
<dd><p>The <code class="docutils literal notranslate"><span class="pre">get_properties_for</span></code> can be used to customize the list of object properties returned for various purposes.
The purposes are defined in <code class="docutils literal notranslate"><span class="pre">zend_prop_purpose</span></code>, which currently entails <code class="docutils literal notranslate"><span class="pre">print_r</span></code>, <code class="docutils literal notranslate"><span class="pre">var_dump</span></code>, the
<code class="docutils literal notranslate"><span class="pre">(array)</span></code> cast, <code class="docutils literal notranslate"><span class="pre">serialize</span></code>, <code class="docutils literal notranslate"><span class="pre">var_export</span></code> and <code class="docutils literal notranslate"><span class="pre">json_encode</span></code>.</p>
</dd></dl>

</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="../classes_objects.html">Classes and objects</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="../extensions_design.html">Extensions design</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer feedback">
        The repository for this book is available on <a href="https://github.com/phpinternalsbook/PHP-Internals-Book">GitHub</a>.
        <br/><br/>
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
            <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
        </a>
        <br />
        The PHP internals book is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-41617167-1', 'phpinternalsbook.com');
      ga('send', 'pageview');
    </script>

  </body>
</html>